<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown转换工具</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; margin-bottom: 20px; color: #333; }
        .wrapper { display: flex; gap: 20px; margin-bottom: 20px; }
        @media (max-width: 768px) { .wrapper { flex-direction: column; } }
        .input-box, .output-box { flex: 1; }
        .box-title { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .box-title h2 { font-size: 18px; color: #555; }
        button { padding: 8px 15px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
        button:hover { background: #45a049; }
        button.copy-btn { background: #2196F3; }
        button.copy-btn:hover { background: #1976D2; }
        button.clear-btn { background: #f44336; }
        button.clear-btn:hover { background: #d32f2f; }
        textarea { width: 100%; height: 400px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; line-height: 1.5; resize: vertical; }
        .output { width: 100%; height: 400px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background: #f9f9f9; overflow-y: auto; font-size: 14px; line-height: 1.6; }
        .output h1, .output h2, .output h3 { margin: 15px 0 10px 0; color: #333; }
        .output p { margin-bottom: 10px; }
        .output ul, .output ol { margin-left: 20px; margin-bottom: 10px; }
        .output blockquote { border-left: 3px solid #ccc; padding-left: 10px; margin: 10px 0; color: #666; }
        .output code { background: #eee; padding: 2px 4px; border-radius: 3px; font-family: monospace; }
        .output pre { background: #333; color: #fff; padding: 10px; border-radius: 5px; overflow-x: auto; margin: 10px 0; }
        .output pre code { background: none; padding: 0; }
        .output a { color: #2196F3; text-decoration: none; }
        .output a:hover { text-decoration: underline; }
        .output img { max-width: 100%; height: auto; margin: 10px 0; }
        .output table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        .output th, .output td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .output th { background: #f2f2f2; }
        .output hr { border: none; height: 1px; background: #ddd; margin: 15px 0; }
        .status { position: fixed; bottom: 20px; right: 20px; background: #4CAF50; color: white; padding: 10px 15px; border-radius: 5px; display: none; }
        .status.show { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Markdown转换工具</h1>
        <div class="wrapper">
            <div class="input-box">
                <div class="box-title">
                    <h2>输入Markdown</h2>
                    <button class="clear-btn">清空</button>
                </div>
                <textarea id="input" placeholder="在这里输入Markdown内容..."></textarea>
            </div>
            <div class="output-box">
                <div class="box-title">
                    <h2>格式化结果</h2>
                    <button class="copy-btn">复制结果</button>
                </div>
                <div class="output" id="output"></div>
            </div>
        </div>
    </div>
    <div class="status" id="status">已复制到剪贴板</div>
    
    <script>
        const input = document.getElementById('input');
        const output = document.getElementById('output');
        const copyBtn = document.querySelector('.copy-btn');
        const clearBtn = document.querySelector('.clear-btn');
        const status = document.getElementById('status');
        
        function convertMarkdown(text) {
            if (!text) return '';
            let html = text;
            
            html = html.replace(/^### (.*)/gm, '<h3>$1</h3>');
            html = html.replace(/^## (.*)/gm, '<h2>$1</h2>');
            html = html.replace(/^# (.*)/gm, '<h1>$1</h1>');
            
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
            html = html.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
            
            html = html.replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1">');
            html = html.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>');
            
            html = html.replace(/^> (.*)/gm, '<blockquote>$1</blockquote>');
            
            html = html.replace(/^\s*[-*+] (.*)/gm, '<li>$1</li>');
            html = html.replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>');
            
            html = html.replace(/^\s*\d+\. (.*)/gm, '<li>$1</li>');
            html = html.replace(/(<li>.*<\/li>\n?)+/g, '<ol>$&</ol>');
            
            html = html.replace(/^\|(.+)\|\n\|\s*[-:]+\s*\|\n((?:\|.+\|\n?)+)/gm, function(match, headers, rows) {
                let table = '<table><thead><tr>';
                headers.split('|').forEach(h => table += `<th>${h.trim()}</th>`);
                table += '</tr></thead><tbody>';
                rows.split('\n').forEach(row => {
                    if (row.trim()) {
                        table += '<tr>';
                        row.split('|').forEach(cell => table += `<td>${cell.trim()}</td>`);
                        table += '</tr>';
                    }
                });
                table += '</tbody></table>';
                return table;
            });
            
            html = html.replace(/^---$/gm, '<hr>');
            
            html = html.replace(/\n\n/g, '</p><p>');
            html = html.replace(/\n/g, '<br>');
            
            return '<p>' + html + '</p>';
        }
        
        function updateOutput() {
            output.innerHTML = convertMarkdown(input.value);
        }
        
        function copyToClipboard() {
            // 获取要复制的HTML内容
            const htmlToCopy = output.innerHTML;

            // 创建一个临时的div来存储原始HTML，用于复制HTML格式
            const tempDiv = document.createElement('div');
            tempDiv.style.position = 'absolute';
            tempDiv.style.left = '-9999px';
            tempDiv.style.whiteSpace = 'pre-wrap';
            tempDiv.innerHTML = htmlToCopy;
            document.body.appendChild(tempDiv);

            // 获取纯文本内容（用于备用）
            const textToCopy = tempDiv.innerText || tempDiv.textContent;

            // 创建一个临时textarea元素用于复制纯文本
            const textarea = document.createElement('textarea');
            textarea.value = textToCopy;
            textarea.style.position = 'absolute';
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);

            // 创建一个包含HTML和纯文本的ClipboardItem
            const htmlBlob = new Blob([htmlToCopy], { type: 'text/html' });
            const textBlob = new Blob([textToCopy], { type: 'text/plain' });

            const data = [
                new ClipboardItem({
                    'text/html': htmlBlob,
                    'text/plain': textBlob
                })
            ];

            // 尝试使用新的Clipboard API（支持复制HTML格式）
            navigator.clipboard.write(data).then(() => {
                status.classList.add('show');
                setTimeout(() => status.classList.remove('show'), 2000);
            }).catch(err => {
                // 如果新的API失败，回退到旧的复制方法（纯文本）
                textarea.select();
                textarea.setSelectionRange(0, 99999);
                document.execCommand('copy');

                status.classList.add('show');
                status.textContent = '已复制纯文本到剪贴板';
                setTimeout(() => {
                    status.classList.remove('show');
                    status.textContent = '已复制到剪贴板';
                }, 2000);
            }).finally(() => {
                // 清理临时元素
                document.body.removeChild(tempDiv);
                document.body.removeChild(textarea);
            });
        }
        
        function clearInput() {
            input.value = '';
            output.innerHTML = '';
            input.focus();
        }
        
        input.addEventListener('input', updateOutput);
        copyBtn.addEventListener('click', copyToClipboard);
        clearBtn.addEventListener('click', clearInput);
        
        updateOutput();
    </script>
</body>
</html>