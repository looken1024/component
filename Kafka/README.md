# Kafka

## 消息积压增加消费者数可以解决吗？

Kafka的并发消费能力，决定于两个核心指标：

1、分区数（Partition数量）：Kafka主题下的分区数决定了并行消费的上限；

2、消费者实例数（Consumer Instance数量）：同一个消费组下，真正"在工作"的实例不能超过分区数。

并发度 = min（分区数，消费者实例数）

每个分区同一时间只能被一个组内消费者消费，分区是并发的上限。

## 解决积压的正确方法有哪些？

1、诊断瓶颈：是消费者慢？业务处理慢？还是分区数不够？

2、优化消费逻辑：去掉慢SQL、大文件操作、同步调用，能异步别同步，能批量别单条

3、检查分区数：分区太少限制并发，可以考虑增加分区（注意分区扩容带来的乱序等问题）

4、合理扩展消费者：在分区数支撑前提下，加消费者才有用

5、监控和预警：持续关注Lag指标，及时发现和响应


